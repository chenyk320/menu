# 使用指南

## 快速开始

### 1. 启动应用
```bash
# 激活虚拟环境
source venv/bin/activate

# 启动应用
python app.py
```

应用将在 http://localhost:8081 启动

### 2. 添加演示数据（首次使用）
```bash
# 在另一个终端窗口中运行
source venv/bin/activate
python demo_data.py
```

### 更新过敏源数据（如果需要）
如果您的数据库中有旧的过敏源数据，需要更新为符合欧盟法规的14类过敏原：
```bash
source venv/bin/activate
python update_allergens.py
```

### 3. 访问网站
- **菜单页面**: http://localhost:8081 （顾客扫描二维码访问的页面）
- **后台管理**: http://localhost:8081/admin （管理员添加/删除菜品）

## 菜单页面功能

### 语言切换
- 点击顶部的"中文"或"Italiano"按钮切换语言
- 所有菜品名称、描述和过敏源信息都会相应切换

### 分类筛选
- 点击分类按钮（全部、开胃菜、第一道菜等）筛选菜品
- "全部"显示所有菜品

### 过敏源信息
- 页面顶部显示所有过敏源的图标和说明
- 每个菜品下方显示对应的过敏源小图标
- 鼠标悬停在过敏源图标上可查看详细信息

## 后台管理功能

### 菜品管理
1. 点击"+ 添加菜品"按钮
2. 填写表单：
   - 菜品序号（如：A001）
   - 中文菜品名
   - 意大利语菜品名
   - 意大利语描述（可选）
   - 价格（欧元）
   - 选择分类
   - 上传图片（可选）
   - 选择过敏源（可选）
3. 点击"保存"

### 分类管理
- 添加新的菜品分类
- 删除未使用的分类

### 过敏源管理
- 添加新的过敏源类型
- 设置过敏源图标（emoji）
- 删除过敏源（会自动从所有菜品中移除）

## 二维码生成

### 自动生成二维码
```bash
source venv/bin/activate
python generate_qr.py
```

这将：
1. 自动检测本机IP地址
2. 生成包含菜单URL的二维码
3. 保存为 `menu_qr.png` 文件
4. 自动打开图片查看器

### 手动生成二维码
如果自动检测IP不准确，可以手动编辑 `generate_qr.py` 文件中的URL。

## 部署到服务器

### 1. 上传文件
将所有文件上传到服务器

### 2. 安装依赖
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 3. 修改配置
编辑 `app.py` 文件，修改以下配置：
- 修改 `SECRET_KEY`
- 根据需要修改端口号
- 设置 `debug=False` 用于生产环境

### 4. 启动应用
```bash
source venv/bin/activate
python app.py
```

### 5. 生成二维码
使用服务器的实际IP地址生成二维码：
```bash
python generate_qr.py
```

## 注意事项

1. **端口冲突**: 如果端口8080被占用，修改 `app.py` 中的端口号
2. **图片存储**: 上传的图片保存在 `static/images/` 目录
3. **数据库**: SQLite数据库文件会在首次运行时自动创建
4. **备份**: 定期备份 `menu.db` 数据库文件
5. **安全性**: 生产环境请使用更安全的配置和密钥

## 故障排除

### 应用无法启动
- 检查端口是否被占用
- 确认虚拟环境已激活
- 检查依赖是否正确安装

### 图片无法显示
- 确认图片文件存在于 `static/images/` 目录
- 检查文件权限
- 使用浏览器开发者工具查看网络请求

### 数据库错误
- 删除 `menu.db` 文件重新创建
- 检查 `instance/` 目录权限

### 二维码无法访问
- 确认服务器IP地址正确
- 检查防火墙设置
- 确认应用正在运行